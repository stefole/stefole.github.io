<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-09-18">

<title>Week 3: Gene Ontology – Systems Biology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-304f47ec743b7657586ca7c3ce2f276f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-e4df966e8e1c0a93738432f23545dc51.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles/fonts.css">
<link rel="stylesheet" href="../styles/styles.css">
</head>

<body class="nav-fixed fullcontent quarto-dark"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = true;
    const darkModeDefault = authorPrefersDark;
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Systems Biology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://stefole.github.io/molbio/"> 
<span class="menu-text">Molecular Biology</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://kurser.dtu.dk/course/22140"> 
<span class="menu-text">Course Specification</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 3: Gene Ontology</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Gene Ontology</div>
    <div class="quarto-category">Enrichment Analysis</div>
    <div class="quarto-category">fgsea</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 18, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fgsea)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'fgsea' was built under R version 4.5.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(msigdbr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="goals" class="level2">
<h2 class="anchored" data-anchor-id="goals">Goals:</h2>
<p>Today we will start working with GSEA!</p>
<ol type="1">
<li><p>Understand how Gene Ontology terms are defined and organized:</p>
<ul>
<li>The relationship between GO terms (IS A, PART OF, etc)</li>
<li>The three main trunks of GO: BIOLOGICAL PROCESS, MOLECULAR FUNCTION and CELLULAR COMPONENT.</li>
</ul></li>
<li><p>Learn how to query the Gene Ontology database.</p>
<ul>
<li>Using the official online GO query system: AmiGO</li>
<li>Using links from UniProt.</li>
</ul></li>
<li><p>Understand the theory behind GO over-representation analysis</p></li>
<li><p>Learn how to perform GO over-representation analysis:</p>
<ul>
<li>Using the R package “fgsea”</li>
</ul></li>
</ol>
<p><strong>First, we will investigate “cell division” using</strong> <a href="http://amigo.geneontology.org">AmiGO 2</a>.</p>
<p>By clicking on “Graph views”, we can open QuickGO and see how many ancestor and children terms are defined, as well as the different types of relationships they have.</p>
<p><strong><em>GO has a few relationship categories.</em></strong> For more information, you can browse the exercises here and do the non-coding exercises to get a feel for the categories: <a href="https://teaching.healthtech.dtu.dk/22140/index.php/ExGeneOntology_R" class="uri">https://teaching.healthtech.dtu.dk/22140/index.php/ExGeneOntology_R</a>. <strong><em>But here is an LLM-generated outline:</em></strong></p>
<section id="structural-relationships" class="level3">
<h3 class="anchored" data-anchor-id="structural-relationships">🧬 Structural Relationships</h3>
</section>
<section id="is_a-a-type-of" class="level3">
<h3 class="anchored" data-anchor-id="is_a-a-type-of"><code>is_a</code> — “a type of”</h3>
<p>This is the simplest one.<br>
Think of it like saying <strong>“X is a more specific type of Y.”</strong></p>
<ul>
<li><p><strong>Example:</strong></p>
<ul>
<li><strong>GO:0005739 mitochondrion</strong><br>
<em>is_a</em> <strong>GO:0043231 intracellular membrane-bounded organelle</strong></li>
</ul></li>
<li><p>Meaning: Every mitochondrion <strong>is</strong> an intracellular membrane-bounded organelle.</p></li>
</ul>
<p><strong>Practical use:</strong> When you annotate a gene to “mitochondrion,” it automatically counts as being in “intracellular organelle” too. Tools use this to group related things together.</p>
<hr>
</section>
<section id="part_of-always-contained-within" class="level3">
<h3 class="anchored" data-anchor-id="part_of-always-contained-within"><code>part_of</code> — “always contained within”</h3>
<p>This says that <strong>wherever X exists, it’s part of Y.</strong></p>
<ul>
<li><p><strong>Example:</strong></p>
<ul>
<li><strong>GO:0000776 kinetochore</strong><br>
<em>part_of</em> <strong>GO:0000775 chromosome, centromeric region</strong></li>
</ul></li>
<li><p>Meaning: Whenever a kinetochore exists, it’s sitting inside the centromeric region of a chromosome.</p></li>
</ul>
<p><strong>Practical use:</strong> If you see genes annotated to “kinetochore,” you can infer they’re also involved with the centromeric chromosome structure, even if not directly annotated.</p>
<hr>
</section>
<section id="has_part-always-contains" class="level3">
<h3 class="anchored" data-anchor-id="has_part-always-contains"><code>has_part</code> — “always contains”</h3>
<p>This is the opposite: <strong>if Y exists, it contains X as a piece.</strong></p>
<ul>
<li><p><strong>Example:</strong></p>
<ul>
<li><strong>GO:0005840 ribosome</strong><br>
<em>has_part</em> <strong>GO:0003735 structural constituent of ribosome</strong></li>
</ul></li>
<li><p>Meaning: Every ribosome <strong>has</strong> some structural ribosomal proteins inside.</p></li>
</ul>
<p><strong>Practical use:</strong> This is used more for reasoning than annotation, but helps ontology tools understand what structures are made of.</p>
<hr>
</section>
</section>
<section id="functional-process-relationships" class="level2">
<h2 class="anchored" data-anchor-id="functional-process-relationships">⚙️ Functional / Process Relationships</h2>
<section id="regulates-influences-how-much-how-fast" class="level3">
<h3 class="anchored" data-anchor-id="regulates-influences-how-much-how-fast"><code>regulates</code> — “influences how much / how fast”</h3>
<p>This links processes that <strong>control other processes</strong>.</p>
<ul>
<li><p><strong>Example:</strong></p>
<ul>
<li><strong>GO:0048523 negative regulation of cellular process</strong><br>
<em>regulates</em> <strong>GO:0009987 cellular process</strong></li>
</ul></li>
<li><p>Meaning: This is a process that dials down (inhibits) some cellular process.</p></li>
</ul>
<p><strong>Practical use:</strong> If your gene is involved in regulation, it may not directly perform the target process — it’s a controller, not a worker.</p>
<hr>
</section>
<section id="positively_regulates-negatively_regulates" class="level3">
<h3 class="anchored" data-anchor-id="positively_regulates-negatively_regulates"><code>positively_regulates</code> / <code>negatively_regulates</code></h3>
<p>These are more specific kinds of <code>regulates</code>.</p>
<ul>
<li><p><strong>Example:</strong></p>
<ul>
<li><strong>GO:0043065 positive regulation of apoptotic process</strong><br>
<em>positively_regulates</em> <strong>GO:0006915 apoptotic process</strong></li>
</ul></li>
<li><p>Meaning: This process <strong>boosts</strong> apoptosis.<br>
(And conversely, “negative regulation” <strong>blocks</strong> it.)</p></li>
</ul>
<p><strong>Practical use:</strong> Helps distinguish activators vs.&nbsp;inhibitors of the same pathway in analysis.</p>
<hr>
</section>
<section id="occurs_in-happens-inside" class="level3">
<h3 class="anchored" data-anchor-id="occurs_in-happens-inside"><code>occurs_in</code> — “happens inside”</h3>
<p>This ties a <strong>process</strong> to a <strong>location</strong>.</p>
<ul>
<li><p><strong>Example:</strong></p>
<ul>
<li><strong>GO:0006260 DNA replication</strong><br>
<em>occurs_in</em> <strong>GO:0005634 nucleus</strong></li>
</ul></li>
<li><p>Meaning: DNA replication takes place in the nucleus (in eukaryotes).</p></li>
</ul>
<p><strong>Practical use:</strong> Lets you connect dynamic events to the cell structures they happen in.</p>
<hr>
</section>
<section id="capable_of-can-do-this" class="level3">
<h3 class="anchored" data-anchor-id="capable_of-can-do-this"><code>capable_of</code> — “can do this”</h3>
<p>This says a <strong>structure can perform a function or process.</strong></p>
<ul>
<li><p><strong>Example:</strong></p>
<ul>
<li><strong>GO:0005665 DNA-directed RNA polymerase II, core complex</strong><br>
<em>capable_of</em> <strong>GO:0003899 DNA-directed RNA polymerase activity</strong></li>
</ul></li>
<li><p>Meaning: This protein complex <strong>can do</strong> the activity of RNA polymerase.</p></li>
</ul>
<p><strong>Practical use:</strong> Connects physical complexes (what something <strong>is</strong>) to what they <strong>do</strong>.</p>
<hr>
</section>
<section id="logical-notes" class="level3">
<h3 class="anchored" data-anchor-id="logical-notes">🧠 Logical Notes</h3>
<ul>
<li><p>GO is structured as a <strong>Directed Acyclic Graph (DAG)</strong>: terms can have multiple parents.</p></li>
<li><p>Relationships define the logical inference engine used by GO tools (like enrichment analysis and ontology reasoners).</p></li>
<li><p>Not all relationships are used in all GO branches; e.g.&nbsp;<code>regulates</code> is only used in <strong>biological process</strong> branch, while <code>capable_of</code> links <strong>cellular components</strong> to <strong>functions</strong> or <strong>processes</strong>.</p></li>
</ul>
<hr>
</section>
</section>
<section id="part-2-gene-ontology-overrepresentation-analysis-ora" class="level1">
<h1>Part 2: Gene Ontology overrepresentation analysis (ORA)</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here I just import the exercise data.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"data/clusterexGO.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 16 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (2): Gene, Description
dbl (3): DNA_replication, DNA_repair, Cell_cycle

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>bg_terms <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"data/background_countsexGO.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.
Rows: 3 Columns: 2── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (1): term
dbl (1): bg_count
ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>bg_total <span class="ot">&lt;-</span> <span class="dv">5500</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>cluster</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   Gene    Description                     DNA_replication DNA_repair Cell_cycle
   &lt;chr&gt;   &lt;chr&gt;                                     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 CTF18   Chromosome transmission fideli…               1          1          1
 2 DPB2    DNA polymerase epsilon subunit…               1          1          1
 3 DPB3    DNA polymerase epsilon subunit…               1          1          0
 4 POL12   DNA polymerase alpha subunit B                1          0          0
 5 POL1    DNA polymerase alpha catalytic…               1          0          0
 6 POL2    DNA polymerase epsilon catalyt…               1          1          0
 7 ELG1    Telomere length regulation pro…               1          1          1
 8 MET16   Phosphoadenosine phosphosulfat…               0          0          0
 9 PRI1    DNA primase small subunit                     1          0          0
10 PRI2    DNA primase large subunit                     1          0          0
11 RFC1    Replication factor C subunit 1                1          1          1
12 RFC2    Replication factor C subunit 2                1          1          1
13 RFC3    Replication factor C subunit 3                1          1          1
14 RFC4    Replication factor C subunit 4                1          1          1
15 RFC5    Replication factor C subunit 5                1          1          1
16 YCL042W Putative uncharacterized prote…               0          0          0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bg_terms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  term            bg_count
  &lt;chr&gt;              &lt;dbl&gt;
1 DNA_replication       96
2 DNA_repair           259
3 Cell_cycle           313</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow is a base R function that tells the number of rows, in my case it is the number of proteins in the cluster -- 16.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cluster)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we will sum up all the columns. To understand what this does, you have to know the structure of the table. we have a protein X, and then the association of that protein X with three columns GO terms, namely DNA replication (GO:0006260), DNA repair (GO:0006281), Cell cycle (GO:0007049), denoted by 1 (yes, associated) and 0 (no, not associated). So when we sum up all the columns we get the number of proteins in the cluster that are associated with a given GO term. </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>observed <span class="ot">&lt;-</span> <span class="fu">colSums</span>(cluster[, <span class="fu">c</span>(<span class="st">"DNA_replication"</span>, <span class="st">"DNA_repair"</span>, <span class="st">"Cell_cycle"</span>)])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>observed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DNA_replication      DNA_repair      Cell_cycle 
             14              10               8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bg_terms has the total number of proteins listed that are involved in the three GO categories "DNA replication", "DNA repair" and "Cell cycle" across the entire genome.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># %&gt;% is the pipe operator from the tidyverse. It means take the thing on the left and pass it into the function on the right. </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mutate() adds a new column to the data frame or overwrites an existing one. </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># So here we’re creating a new column called freq_bg. Inside mutate(), freq_bg = bg_count / bg_total means: divide the number of genes annotated to the term (bg_count) by the total number of background genes (bg_total = 5500). So as a result, for each GO term, we now have the genome-wide frequency.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>bg_terms <span class="ot">&lt;-</span> bg_terms <span class="sc">%&gt;%</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq_bg =</span> bg_count <span class="sc">/</span> bg_total)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># See the new column.</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>bg_terms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  term            bg_count freq_bg
  &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;
1 DNA_replication       96  0.0175
2 DNA_repair           259  0.0471
3 Cell_cycle           313  0.0569</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we do the same -- add a new column, but that column is now the number of expected proteins associated with a given GO term in a randow draw of 16 proteins (n).</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>bg_terms <span class="ot">&lt;-</span> bg_terms <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">expected =</span> freq_bg <span class="sc">*</span> n)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>bg_terms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  term            bg_count freq_bg expected
  &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 DNA_replication       96  0.0175    0.279
2 DNA_repair           259  0.0471    0.753
3 Cell_cycle           313  0.0569    0.911</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we add the observed (colSums) column to the table matched by name of GO term. </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>bg_terms <span class="ot">&lt;-</span> bg_terms <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">observed =</span> observed[term])</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>bg_terms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term            bg_count freq_bg expected observed
  &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 DNA_replication       96  0.0175    0.279       14
2 DNA_repair           259  0.0471    0.753       10
3 Cell_cycle           313  0.0569    0.911        8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># So enrichment is simply the number of observed divided by the number of expected, which we calculated earlier. Reminder: expected is a decimal, but not a proportion!</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>bg_terms <span class="ot">&lt;-</span> bg_terms <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">enrichment =</span> observed<span class="sc">/</span>expected)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>bg_terms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  term            bg_count freq_bg expected observed enrichment
  &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 DNA_replication       96  0.0175    0.279       14      50.1 
2 DNA_repair           259  0.0471    0.753       10      13.3 
3 Cell_cycle           313  0.0569    0.911        8       8.79</code></pre>
</div>
</div>
<p>Now we will build a table like that for each GO term to perform the <a href="https://en.wikipedia.org/wiki/Fisher%27s_exact_test">Fischer’s exact test</a>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 27%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>In cluster (n=16)</th>
<th>Not in cluster (5500 − 16)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Annotated</strong></td>
<td>a = observed</td>
<td>c = bg_count − observed</td>
</tr>
<tr class="even">
<td><strong>Not annotated</strong></td>
<td>b = n − observed</td>
<td>d = (bg_total − bg_count) − b</td>
</tr>
</tbody>
</table>
<p>Where:</p>
<ul>
<li><p><strong>a</strong> = how many cluster genes had the term (observed).</p></li>
<li><p><strong>b</strong> = how many cluster genes did <em>not</em> have the term.</p></li>
<li><p><strong>c</strong> = how many background genes (outside your cluster) had the term.</p></li>
<li><p><strong>d</strong> = the rest (background genes without the term, excluding your cluster).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed associated with DNA replication</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> observed[<span class="st">"DNA_replication"</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of proteins in cluster NOT associated with DNA replication</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> n <span class="sc">-</span> a</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># "c" is the number of DNA replication genes OUTSIDE the cluster</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1:bg_terms$bg_count[] looks up how many DNA replication genes exist in the whole genome (in this case: 96 total). On the operator $: bg_terms$bg_count means: “From the data frame bg_terms, give me the column named bg_count.”. when we specify bg_terms$term == "DNA_Replication", we get the bg_count of dna_replication.</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: subtract "a", the ones we already counted inside the cluster. That leaves only the ones not in the cluster.</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> bg_terms<span class="sc">$</span>bg_count[bg_terms<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"DNA_replication"</span>] <span class="sc">-</span> a</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># here the login is the same, but it is the number of genes that in the whole genome are NOT associated with dna replication minus the genes in the cluster that are not associated with DNA replication.</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> (bg_total <span class="sc">-</span> bg_terms<span class="sc">$</span>bg_count[bg_terms<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"DNA_replication"</span>]) <span class="sc">-</span> b</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we create the table mentioned above.</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a, b, c, d), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"has_term"</span>,<span class="st">"no_term"</span>),</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">"in_cluster"</span>,<span class="st">"not_in_cluster"</span>)))</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         in_cluster not_in_cluster
has_term         14              2
no_term          82           5402</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative = "greater" sets the direction of the hypothesis test.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># "greater" = test if the GO term is over-represented in the cluster.</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (Other options: "less" tests under-representation; "two.sided" tests either way.)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(m, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data

data:  m
p-value &lt; 2.2e-16
alternative hypothesis: true odds ratio is greater than 1
95 percent confidence interval:
 122.089     Inf
sample estimates:
odds ratio 
  457.4204 </code></pre>
</div>
</div>
<ul>
<li><p>p-value &lt; 2.2e-16 is the probability this enrichment happened by chance is effectively zero.</p></li>
<li><p>alternative hypothesis -&gt; we asked if the term is over-represented (so odds ratio &gt; 1), and the test says yes.</p></li>
<li><p>95% confidence interval (122.089 – Inf) -&gt; the real effect is at least 122x, maybe higher (upper bound open).</p></li>
<li><p>odds ratio 457.4204 -&gt; genes in the cluster are about 457 times more likely to have this GO term than random genes in the genome.</p></li>
</ul>
<p>Now lets repeat this for the other two GO terms!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DNA repair</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> observed[<span class="st">"DNA_repair"</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> n <span class="sc">-</span> a</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> bg_terms<span class="sc">$</span>bg_count[bg_terms<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"DNA_repair"</span>] <span class="sc">-</span> a</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> (bg_total <span class="sc">-</span> bg_terms<span class="sc">$</span>bg_count[bg_terms<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"DNA_repair"</span>]) <span class="sc">-</span> b</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>m_repair <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a, b, c, d), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"has_term"</span>,<span class="st">"no_term"</span>),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">"in_cluster"</span>,<span class="st">"not_in_cluster"</span>)))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(m_repair, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data

data:  m_repair
p-value = 2.821e-10
alternative hypothesis: true odds ratio is greater than 1
95 percent confidence interval:
 13.35747      Inf
sample estimates:
odds ratio 
  34.95624 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell cycle</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> observed[<span class="st">"Cell_cycle"</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> n <span class="sc">-</span> a</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> bg_terms<span class="sc">$</span>bg_count[bg_terms<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"Cell_cycle"</span>] <span class="sc">-</span> a</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> (bg_total <span class="sc">-</span> bg_terms<span class="sc">$</span>bg_count[bg_terms<span class="sc">$</span>term <span class="sc">==</span> <span class="st">"Cell_cycle"</span>]) <span class="sc">-</span> b</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>m_cycle <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a, b, c, d), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"has_term"</span>,<span class="st">"no_term"</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">"in_cluster"</span>,<span class="st">"not_in_cluster"</span>)))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(m_cycle, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data

data:  m_cycle
p-value = 8.68e-07
alternative hypothesis: true odds ratio is greater than 1
95 percent confidence interval:
 6.505564      Inf
sample estimates:
odds ratio 
  16.95374 </code></pre>
</div>
</div>
<p>So here we can see that for DNA repair p is 2.8e-10, so extremely significant odds ratio of 35. Cluster genes are about 35 times more likely to be DNA repair genes than random genes!</p>
<p>Cell cycle p = 8.7e-7, and a highly significant odds ratio of 17. Cluster genes are about 17 times more likely to be cell cycle genes than random genes.</p>
<p>So all three GO terms are significantly enriched in the cluster.</p>
<section id="automated-analysis-using-fgsea-and-msigdbr" class="level2">
<h2 class="anchored" data-anchor-id="automated-analysis-using-fgsea-and-msigdbr">Automated analysis using “fgsea” and “msigdbr”</h2>
<p>Here are a few tips from ChatGPT before we start:</p>
<ul>
<li><p><code>msigdbr(...)</code> returns a <strong>data frame</strong> with columns like <code>gs_name</code> (gene set name) and <code>ensembl_gene</code> (gene IDs).</p></li>
<li><p><code>fgsea::fora()</code> expects <strong>pathways as a named list</strong>: <code>list(GENESET1 = c(g1, g2, ...), GENESET2 = c(...))</code>.</p></li>
<li><p>Therefore: <strong>you cannot feed the msigdbr data frame directly</strong> to <code>fora()</code>. You must convert it with <code>split()</code>.</p></li>
<li><p>Also, your <strong>target</strong> and <strong>background</strong> IDs must be in the <strong>same ID namespace</strong> as the gene sets (we’ll use Ensembl-like yeast ORFs; your <code>ID</code> column looks good).</p></li>
</ul>
<section id="universe-background" class="level3">
<h3 class="anchored" data-anchor-id="universe-background">🪐 “Universe” (background)</h3>
<ul>
<li><p>The <strong>universe</strong> is the <strong>full set of all genes you could possibly draw from</strong>.</p></li>
<li><p>It’s also called the <strong>background list</strong> or <strong>population group</strong>.</p></li>
<li><p>In your case, it’s the <code>background</code> object you loaded from <code>exercise3_part2.Rdata</code> — a list of <strong>all annotated yeast genes</strong>.</p></li>
<li><p><code>fora()</code> uses it to figure out what “random chance” looks like.<br>
If 100 out of 5500 genes are DNA repair genes, that’s the baseline probability.</p></li>
</ul>
<p>So:<br>
<strong>Universe = all yeast genes.</strong><br>
<strong>Target = your cluster 1 genes.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/exercise3_part1.Rdata"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/exercise3_part2.Rdata"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># From now on, I will personally need a lot of help from ChatGPT, but I will try to decipher everything as well.</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This command retrieves biological process gene sets for yeast. The "C5" category is the msigdb annotation for the three gene ontologies. The subcategory is either "BP" (biological process), "MF" (molecular function), or "CC" (cellular component).</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we take BP (biological process)</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>BP_df <span class="ot">=</span> <span class="fu">msigdbr</span>(<span class="at">species =</span> <span class="st">"S. cerevisiae"</span>, <span class="at">category =</span> <span class="st">"C5"</span>, <span class="at">subcategory =</span> <span class="st">"BP"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `category` argument of `msigdbr()` is deprecated as of msigdbr 10.0.0.
ℹ Please use the `collection` argument instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `subcategory` argument of `msigdbr()` is deprecated as of msigdbr 10.0.0.
ℹ Please use the `subcollection` argument instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect structure and a few rows</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(BP_df)          <span class="co"># how many rows &amp; columns?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 108337     26</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(BP_df)        <span class="co"># column names available</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "gene_symbol"          "ncbi_gene"            "ensembl_gene"        
 [4] "db_gene_symbol"       "db_ncbi_gene"         "db_ensembl_gene"     
 [7] "source_gene"          "gs_id"                "gs_name"             
[10] "gs_collection"        "gs_subcollection"     "gs_collection_name"  
[13] "gs_description"       "gs_source_species"    "gs_pmid"             
[16] "gs_geoid"             "gs_exact_source"      "gs_url"              
[19] "db_version"           "db_target_species"    "ortholog_taxon_id"   
[22] "ortholog_sources"     "num_ortholog_sources" "entrez_gene"         
[25] "gs_cat"               "gs_subcat"           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(BP_df[, <span class="fu">c</span>(<span class="st">"gs_name"</span>,<span class="st">"ensembl_gene"</span>)], <span class="dv">5</span>)   <span class="co"># key columns we’ll use</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  gs_name                                          ensembl_gene
  &lt;chr&gt;                                            &lt;chr&gt;       
1 GOBP_10_FORMYLTETRAHYDROFOLATE_METABOLIC_PROCESS YGR204W     
2 GOBP_10_FORMYLTETRAHYDROFOLATE_METABOLIC_PROCESS YGR204W     
3 GOBP_10_FORMYLTETRAHYDROFOLATE_METABOLIC_PROCESS YBR084W     
4 GOBP_2FE_2S_CLUSTER_ASSEMBLY                     YGL220W     
5 GOBP_2FE_2S_CLUSTER_ASSEMBLY                     YPL252C     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>BP_list <span class="ot">=</span> <span class="fu">split</span>(<span class="at">x =</span> BP_df<span class="sc">$</span>ensembl_gene, <span class="at">f =</span> BP_df<span class="sc">$</span>gs_name)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect to see what one looks like</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(BP_list)          <span class="co"># number of gene sets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5906</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(BP_list)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]       <span class="co"># first few set names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "GOBP_10_FORMYLTETRAHYDROFOLATE_METABOLIC_PROCESS"
[2] "GOBP_2_OXOGLUTARATE_METABOLIC_PROCESS"           
[3] "GOBP_2FE_2S_CLUSTER_ASSEMBLY"                    
[4] "GOBP_3_UTR_MEDIATED_MRNA_DESTABILIZATION"        
[5] "GOBP_3_UTR_MEDIATED_MRNA_STABILIZATION"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(BP_list[[<span class="dv">1</span>]], <span class="dv">10</span>)    <span class="co"># genes inside first set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "YGR204W" "YGR204W" "YBR084W"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Universe: all genes that are "possible draws" for this analysis.</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We take them from the node table's ORF IDs so they match msigdbr's ORF IDs.</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>universe <span class="ot">&lt;-</span> <span class="fu">unique</span>(node_attributes<span class="sc">$</span>ID)   <span class="co"># unique() removes duplicates</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Then clean BP sets to that universe</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>clean_sets <span class="ot">&lt;-</span> <span class="cf">function</span>(pathways, universe){</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  sets <span class="ot">&lt;-</span> <span class="fu">lapply</span>(pathways, <span class="cf">function</span>(g) <span class="fu">intersect</span>(<span class="fu">unique</span>(g), universe))</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  sets[<span class="fu">vapply</span>(sets, length, <span class="fu">integer</span>(<span class="dv">1</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>BP_list <span class="ot">&lt;-</span> <span class="fu">clean_sets</span>(BP_list, universe)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick sanity peek:</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(universe)     <span class="co"># How big is the universe? (a count)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 300</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(universe, <span class="dv">5</span>)    <span class="co"># What do these IDs look like? Should be Yxxx... style</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "YLR131C" "YNR044W" "YGL032C" "YBR158W" "YGL240W"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Target: the actual genes we're testing for enrichment (Cluster #1).</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Boolean filter: keep rows where the 'cluster' column equals the label "cluster1",</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># then pull their ORF IDs and drop duplicates.</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">unique</span>(node_attributes<span class="sc">$</span>ID[node_attributes<span class="sc">$</span>cluster <span class="sc">==</span> <span class="st">"cluster1"</span>])</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick sanity peek:</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(target)       <span class="co"># How many genes are in Cluster #1?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(target, <span class="dv">5</span>)      <span class="co"># Do these look like ORF IDs too?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA        "YMR078C" "YPR175W" "YBR278W" "YBL035C"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity checks that prevent nonsense results:</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(target))                    <span class="co"># should be 0 (no missing IDs in target)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(target <span class="sc">%in%</span> universe)             <span class="co"># should be TRUE (every target in the universe)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ⚠️ Problem — one of your target entries is NA. That means at least one row in cluster1 had a missing ID.</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing it: </span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> target[<span class="sc">!</span><span class="fu">is.na</span>(target)]</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rechecking: </span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(target <span class="sc">%in%</span> universe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run over-representation for BP</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>res_bp <span class="ot">&lt;-</span> <span class="fu">fora</span>(<span class="at">pathways =</span> BP_list,   <span class="co"># named list: set -&gt; vector of ORF IDs</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">genes    =</span> target,    <span class="co"># your cluster-1 ORF IDs</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">universe =</span> universe)  <span class="co"># all possible ORF IDs (background)</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># See what columns we got back</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res_bp)        <span class="co"># should include: pathway, pval, padj, size, overlap</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "pathway"        "pval"           "padj"           "foldEnrichment"
[5] "overlap"        "size"           "overlapGenes"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_bp, <span class="dv">5</span>)      <span class="co"># quick peek at the first rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                            pathway
                                                             &lt;char&gt;
1:                                    GOBP_DNA_BIOSYNTHETIC_PROCESS
2:                                             GOBP_DNA_REPLICATION
3:                               GOBP_DNA_TEMPLATED_DNA_REPLICATION
4: GOBP_POSITIVE_REGULATION_OF_DNA_DIRECTED_DNA_POLYMERASE_ACTIVITY
5:                                       GOBP_DNA_METABOLIC_PROCESS
           pval         padj foldEnrichment overlap  size
          &lt;num&gt;        &lt;num&gt;          &lt;num&gt;   &lt;int&gt; &lt;int&gt;
1: 2.333504e-09 5.171045e-06      10.546875       9    16
2: 7.850384e-09 8.698226e-06       5.625000      12    40
3: 2.316292e-08 1.710968e-05       6.066176      11    34
4: 2.230525e-07 1.235711e-04      18.750000       5     5
5: 4.959087e-07 2.197867e-04       4.090909      12    55
                                          overlapGenes
                                                &lt;list&gt;
1: YMR078C,YNL102W,YNL262W,YPR175W,YOR217W,YOL094C,...
2: YMR078C,YNL102W,YBL035C,YNL262W,YPR175W,YIR008C,...
3: YNL102W,YBL035C,YNL262W,YPR175W,YIR008C,YKL045W,...
4:             YMR078C,YOL094C,YBR087W,YJR068W,YNL290W
5: YMR078C,YNL102W,YBL035C,YNL262W,YPR175W,YIR008C,...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>add_enrichment <span class="ot">&lt;-</span> <span class="cf">function</span>(res, universe, target){</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  expected   <span class="ot">&lt;-</span> (res<span class="sc">$</span>size <span class="sc">/</span> <span class="fu">length</span>(universe)) <span class="sc">*</span> <span class="fu">length</span>(target)  <span class="co"># random-draw expectation</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  enrichment <span class="ot">&lt;-</span> res<span class="sc">$</span>overlap <span class="sc">/</span> expected                          <span class="co"># effect size (observed/expected)</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">cbind</span>(res, <span class="at">expected =</span> expected, <span class="at">enrichment =</span> enrichment)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  out[<span class="fu">order</span>(out<span class="sc">$</span>padj, out<span class="sc">$</span>pval), ]                              <span class="co"># rank by adjusted p-value</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>res_bp <span class="ot">&lt;-</span> <span class="fu">add_enrichment</span>(res_bp, universe, target)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Show top-10 BP terms for your report</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>top10_bp <span class="ot">&lt;-</span> <span class="fu">head</span>(res_bp[, <span class="fu">c</span>(<span class="st">"pathway"</span>,<span class="st">"overlap"</span>,<span class="st">"size"</span>,<span class="st">"expected"</span>,<span class="st">"enrichment"</span>,<span class="st">"pval"</span>,<span class="st">"padj"</span>)], <span class="dv">10</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>top10_bp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                             pathway overlap
                                                              &lt;char&gt;   &lt;int&gt;
 1:                                    GOBP_DNA_BIOSYNTHETIC_PROCESS       9
 2:                                             GOBP_DNA_REPLICATION      12
 3:                               GOBP_DNA_TEMPLATED_DNA_REPLICATION      11
 4: GOBP_POSITIVE_REGULATION_OF_DNA_DIRECTED_DNA_POLYMERASE_ACTIVITY       5
 5:                                       GOBP_DNA_METABOLIC_PROCESS      12
 6:             GOBP_POSITIVE_REGULATION_OF_DNA_BIOSYNTHETIC_PROCESS       5
 7:                      GOBP_REGULATION_OF_DNA_BIOSYNTHETIC_PROCESS       5
 8:                         GOBP_DNA_REPLICATION_SYNTHESIS_OF_PRIMER       4
 9:                 GOBP_POSITIVE_REGULATION_OF_TRANSFERASE_ACTIVITY       5
10:                   GOBP_POSITIVE_REGULATION_OF_CATALYTIC_ACTIVITY       5
     size  expected enrichment         pval         padj
    &lt;int&gt;     &lt;num&gt;      &lt;num&gt;        &lt;num&gt;        &lt;num&gt;
 1:    16 0.8533333  10.546875 2.333504e-09 5.171045e-06
 2:    40 2.1333333   5.625000 7.850384e-09 8.698226e-06
 3:    34 1.8133333   6.066176 2.316292e-08 1.710968e-05
 4:     5 0.2666667  18.750000 2.230525e-07 1.235711e-04
 5:    55 2.9333333   4.090909 4.959087e-07 2.197867e-04
 6:     6 0.3200000  15.625000 1.296729e-06 4.105073e-04
 7:     6 0.3200000  15.625000 1.296729e-06 4.105073e-04
 8:     4 0.2133333  18.750000 5.501961e-06 1.524043e-03
 9:     9 0.4800000  10.416667 2.476143e-05 6.096813e-03
10:    11 0.5866667   8.522727 8.518855e-05 1.716162e-02</code></pre>
</div>
</div>
<p>Now we just repeat the same for CC and MF:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get MF &amp; CC from msigdbr</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>MF_df <span class="ot">&lt;-</span> <span class="fu">msigdbr</span>(<span class="at">species =</span> <span class="st">"S. cerevisiae"</span>, <span class="at">category =</span> <span class="st">"C5"</span>, <span class="at">subcategory =</span> <span class="st">"MF"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>CC_df <span class="ot">&lt;-</span> <span class="fu">msigdbr</span>(<span class="at">species =</span> <span class="st">"S. cerevisiae"</span>, <span class="at">category =</span> <span class="st">"C5"</span>, <span class="at">subcategory =</span> <span class="st">"CC"</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to lists</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>MF_list <span class="ot">&lt;-</span> <span class="fu">split</span>(MF_df<span class="sc">$</span>ensembl_gene, MF_df<span class="sc">$</span>gs_name)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>CC_list <span class="ot">&lt;-</span> <span class="fu">split</span>(CC_df<span class="sc">$</span>ensembl_gene, CC_df<span class="sc">$</span>gs_name)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean to your universe</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>MF_list <span class="ot">&lt;-</span> <span class="fu">clean_sets</span>(MF_list, universe)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>CC_list <span class="ot">&lt;-</span> <span class="fu">clean_sets</span>(CC_list, universe)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Run fora</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>res_mf <span class="ot">&lt;-</span> <span class="fu">fora</span>(MF_list, target, universe)</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>res_cc <span class="ot">&lt;-</span> <span class="fu">fora</span>(CC_list, target, universe)</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add enrichment and take top 10</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>res_mf  <span class="ot">&lt;-</span> <span class="fu">add_enrichment</span>(res_mf, universe, target)</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>res_cc  <span class="ot">&lt;-</span> <span class="fu">add_enrichment</span>(res_cc, universe, target)</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>top10_mf <span class="ot">&lt;-</span> <span class="fu">head</span>(res_mf[, <span class="fu">c</span>(<span class="st">"pathway"</span>,<span class="st">"overlap"</span>,<span class="st">"size"</span>,<span class="st">"expected"</span>,<span class="st">"enrichment"</span>,<span class="st">"pval"</span>,<span class="st">"padj"</span>)], <span class="dv">10</span>)</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>top10_cc <span class="ot">&lt;-</span> <span class="fu">head</span>(res_cc[, <span class="fu">c</span>(<span class="st">"pathway"</span>,<span class="st">"overlap"</span>,<span class="st">"size"</span>,<span class="st">"expected"</span>,<span class="st">"enrichment"</span>,<span class="st">"pval"</span>,<span class="st">"padj"</span>)], <span class="dv">10</span>)</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>top10_mf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                              pathway overlap  size  expected
                                               &lt;char&gt;   &lt;int&gt; &lt;int&gt;     &lt;num&gt;
 1:  GOMF_CATALYTIC_ACTIVITY_ACTING_ON_A_NUCLEIC_ACID      11    27 1.4400000
 2:                    GOMF_DNA_CLAMP_LOADER_ACTIVITY       6     6 0.3200000
 3:             GOMF_CATALYTIC_ACTIVITY_ACTING_ON_DNA       9    23 1.2266667
 4:              GOMF_NUCLEOTIDYLTRANSFERASE_ACTIVITY       5     8 0.4266667
 5:         GOMF_ATP_DEPENDENT_ACTIVITY_ACTING_ON_DNA       6    18 0.9600000
 6:                        GOMF_DNA_HELICASE_ACTIVITY       5    12 0.6400000
 7: GOMF_NUCLEIC_ACID_CONFORMATION_ISOMERASE_ACTIVITY       5    12 0.6400000
 8:        GOMF_SINGLE_STRANDED_DNA_HELICASE_ACTIVITY       5    12 0.6400000
 9:                      GOMF_ATP_HYDROLYSIS_ACTIVITY       6    22 1.1733333
10:         GOMF_DNA_DIRECTED_DNA_POLYMERASE_ACTIVITY       3     4 0.2133333
    enrichment         pval         padj
         &lt;num&gt;        &lt;num&gt;        &lt;num&gt;
 1:   7.638889 1.188845e-09 3.875636e-07
 2:  18.750000 8.317210e-09 1.355705e-06
 3:   7.336957 1.423523e-07 1.546894e-05
 4:  11.718750 1.136017e-05 9.258540e-04
 5:   6.250000 1.077505e-04 5.763922e-03
 6:   7.812500 1.414459e-04 5.763922e-03
 7:   7.812500 1.414459e-04 5.763922e-03
 8:   7.812500 1.414459e-04 5.763922e-03
 9:   5.113636 3.832597e-04 1.388252e-02
10:  14.062500 4.862887e-04 1.443644e-02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>top10_cc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                               pathway overlap
                                                                &lt;char&gt;   &lt;int&gt;
 1:                                              GOCC_REPLICATION_FORK       9
 2:                                        GOCC_CTF18_RFC_LIKE_COMPLEX       5
 3:                              GOCC_DNA_REPLICATION_FACTOR_C_COMPLEX       5
 4:                                        GOCC_DNA_POLYMERASE_COMPLEX       6
 5:                            GOCC_NUCLEAR_PROTEIN_CONTAINING_COMPLEX      11
 6:                          GOCC_ALPHA_DNA_POLYMERASE_PRIMASE_COMPLEX       4
 7:                                        GOCC_RNA_POLYMERASE_COMPLEX       4
 8: GOCC_TRANSFERASE_COMPLEX_TRANSFERRING_PHOSPHORUS_CONTAINING_GROUPS       6
 9:                                                     GOCC_REPLISOME       4
10:                                      GOCC_NUCLEAR_REPLICATION_FORK       4
     size  expected enrichment         pval         padj
    &lt;int&gt;     &lt;num&gt;      &lt;num&gt;        &lt;num&gt;        &lt;num&gt;
 1:    16 0.8533333  10.546875 2.333504e-09 7.443878e-07
 2:     5 0.2666667  18.750000 2.230525e-07 2.371791e-05
 3:     5 0.2666667  18.750000 2.230525e-07 2.371791e-05
 4:     9 0.4800000  12.500000 6.391686e-07 5.097370e-05
 5:    56 2.9866667   3.683036 8.141989e-06 5.194589e-04
 6:     5 0.2666667  15.000000 2.661759e-05 1.415169e-03
 7:     7 0.3733333  10.714286 1.744088e-04 7.948056e-03
 8:    23 1.2266667   4.891304 5.028363e-04 2.005060e-02
 9:     9 0.4800000   8.333333 5.876141e-04 2.082765e-02
10:    10 0.5333333   7.500000 9.473756e-04 3.022128e-02</code></pre>
</div>
</div>
<p>Because I don’t have much time left, I will have ChatGPT explain the logic, probably much better than I will. Perhaps will update it sometime.</p>
<p>Here’s the whole workflow in plain language, with the “why” behind each move.</p>
<p>First, we define two sets of genes. The <strong>universe</strong> (also called background or population) is the pool of all genes we consider “possible draws” for our analysis. In your exercise, we made the universe be <strong>all ORF IDs present in your node table</strong> (e.g., <code>YLR131C</code>). We did this because the gene sets we’ll test (from MSigDB) are also in ORF format; using the same ID system everywhere avoids silent mismatches. The <strong>target</strong> is the list of genes you’re curious about—in this case, the genes in <strong>Cluster 1</strong>. Conceptually, over-representation asks: “If I randomly drew the same number of genes from the universe, how often would I hit genes from a given function? Is my target list hitting that function <em>more often than chance</em>?”</p>
<p>Next, we fetch <strong>Gene Ontology</strong> gene sets with the <code>msigdbr</code> package. GO has three “trunks”: <strong>Biological Process (BP)</strong> for sequences of events like DNA replication, <strong>Molecular Function (MF)</strong> for activities like ATP binding, and <strong>Cellular Component (CC)</strong> for places like the nucleus. <code>msigdbr()</code> returns a <strong>data frame</strong> where each row links one gene set name (<code>gs_name</code>) to one gene (<code>ensembl_gene</code> here means yeast ORF IDs). The over-representation function <code>fgsea::fora()</code> does not want a data frame, though—it wants a <strong>named list</strong> mapping each gene set to a vector of its genes. We create that with <code>split(BP_df$ensembl_gene, BP_df$gs_name)</code>, which literally groups all genes by their set names. Because statistics must reflect the space you’re drawing from, we then <strong>clean</strong> each gene set to your universe using <code>intersect()</code>: if a gene isn’t in your background, we drop it from the set. That way, each set’s <strong>size</strong> truly means “how many genes in <em>your</em> universe belong to this set.”</p>
<p>With inputs aligned, we run <code>fora(pathways = BP_list, genes = target, universe = universe)</code>. For every gene set, <code>fora</code> builds a 2×2 table (in-target vs out-of-target × in-set vs out-of-set) and uses <strong>Fisher’s exact test</strong> to compute a <strong>p-value</strong> (is the overlap bigger than expected by chance?). It also applies <strong>multiple-testing correction</strong> (Benjamini–Hochberg) so you get <strong><code>padj</code></strong>, which is the column you should rank by. The output includes: the gene set name (<code>pathway</code>), <strong><code>size</code></strong> (how many universe genes are in that set), and <strong><code>overlap</code></strong> (how many of your target genes hit that set).</p>
<p>Because raw p-values don’t tell effect size, we add <strong>expected</strong> and <strong>enrichment</strong>. The <strong>expected</strong> number of hits in your target for a set is:<br>
<code>expected = (set size / universe size) × target size</code>.<br>
This is the “random draw” prediction. The <strong>enrichment</strong> is <code>observed / expected = overlap / expected</code>. If enrichment ≫ 1, your target list contains that function far more than chance would predict. We then sort results by <code>padj</code> (and break ties with <code>pval</code>) to see the most statistically convincing terms first, and report the <strong>top 10</strong> for BP, MF, and CC.</p>
<p>Two practical details matter a lot in the real world. First, <strong>ID consistency</strong>: your target, your universe, and your gene sets must use the <strong>same identifier namespace</strong> (we standardized on yeast ORFs like <code>YMR078C</code>). Any mismatch quietly erases overlaps. Second, <strong>data hygiene</strong>: we dropped a single <code>NA</code> in Cluster 1’s IDs because you can’t match a missing identifier to any set; even one NA can break the “all(target %in% universe)” check. Finally, the <strong>choice of universe</strong> changes p-values (and sometimes conclusions). For coursework, using the node table’s IDs is fine and consistent; in research, you’d justify a broader universe (e.g., all expressed genes in your assay) to avoid bias.<br>
</p>
<p>And that will be all for today!</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>